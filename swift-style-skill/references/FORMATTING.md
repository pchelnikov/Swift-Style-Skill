# Formatting Reference

## Column Limit

**Rule: 100 characters maximum per line.**

Exceptions (do not wrap these):
- Long URLs in comments that cannot be broken
- `import` statements
- Code generated by external tools

---

## Braces

**Rule: K&R style — opening brace on the same line, closing brace on its own line.**

```swift
// ✅
if x > 0 {
  doSomething()
} else {
  doSomethingElse()
}

// ❌
if x > 0
{
  doSomething()
}
else
{
  doSomethingElse()
}
```

**Empty blocks:** may be written as `{}`.

**Closures:** the signature goes on the same line as `{`; a line break follows the `in` keyword.

```swift
// ✅
let squares = numbers.map { value in
  value * value
}
```

---

## Semicolons

**Rule: Never use semicolons** to terminate or separate statements.

```swift
// ✅
let a = 1
let b = 2

// ❌
let a = 1; let b = 2
```

Semicolons are permitted only inside string literals or comments.

---

## One Statement Per Line

**Rule: At most one statement per line.**

Single-statement blocks are an exception when the block is trivial:

```swift
// ✅ Acceptable single-line forms
guard let value = value else { return 0 }
defer { file.close() }
let squares = numbers.map { $0 * $0 }

// ✅ Also acceptable
switch someEnum {
case .first: return 5
case .second: return 10
}
```

When in doubt, write it as a multi-line statement. Single-line works well for early returns and simple cleanup; avoid it when the body has significant logic.

---

## Line-Wrapping

**Cardinal rules:**

1. If the entire declaration or expression fits on one line, keep it there.
2. Comma-delimited lists go either fully horizontal or fully vertical — never mixed.
3. A continuation line starting with an unbreakable token is indented at the same level as the original line.
4. A continuation line in a vertical comma-delimited list is indented +2 from the original line.

### Function Declarations

```swift
// ✅ Fits on one line — keep it
func greet(name: String) -> String { ... }

// ✅ Wrapped — each argument on its own line, closing paren/brace placement
public func index<Elements: Collection, Element>(
  of element: Element,
  in collection: Elements
) -> Elements.Index?
where
  Elements.Element == Element,
  Element: Equatable
{
  // ...
}

// ❌ Avoid: zig-zag indentation aligned to opening paren
public func index<Elements: Collection, Element>(of element: Element,
                                                 in collection: Elements) -> Elements.Index? {
```

### Function Calls

Each argument on its own line at +2 when wrapping:

```swift
// ✅
let index = index(
  of: veryLongElementVariableName,
  in: aCollectionOfElementsThatAlsoHappensToHaveALongName
)

// ❌
let index = index(of: veryLongElementVariableName,
                  in: aCollectionOfElementsThatAlsoHappensToHaveALongName)
```

### Control Flow Statements

When wrapping, continuation lines align to the token following the keyword:

```swift
// ✅
if aBooleanValueReturnedByAVeryLongOptionalThing() &&
   aDifferentBooleanValueReturnedByAVeryLongOptionalThing() {
  doSomething()
}

guard let value = aValueReturnedByAVeryLongOptionalThing(),
      let value2 = aDifferentValueReturnedByAVeryLongOptionalThing() else {
  doSomething()
}
```

---

## Horizontal Whitespace

**A single space appears in these locations (only):**

| Location | Example |
|----------|---------|
| Before `(` opening a conditional | `if (x == 0)` → `if (x == 0)` |
| Around binary and ternary operators | `let x = a + b` |
| Before `{` and after `{` when code follows on same line | `map { $0 * $0 }` |
| Before `}` when code precedes it | `.filter { $0 >= 0 }` |
| After `,` | `func f(a: Int, b: Int)` |
| After `:` in dictionaries and labels (never before) | `[key: value]`, `case .x:` |

**No space:**

| Location | Example |
|----------|---------|
| Before `(` in function calls | `foo(a: 1)` not `foo (a: 1)` |
| Inside brackets | `[1, 2]` not `[ 1, 2 ]` |
| Before `:` in type annotations | `var x: Int` not `var x : Int` |
| Between a closure and `.` chaining | `.map { $0 * $0 }.filter { $0 > 0 }` |

---

## Horizontal Alignment

**Rule: Never align tokens horizontally across lines.**

```swift
// ❌ Horizontal alignment — fragile, noisy diffs
let name:     String = "Alice"
let age:      Int    = 30
let isActive: Bool   = true

// ✅
let name: String = "Alice"
let age: Int = 30
let isActive: Bool = true
```

---

## Vertical Whitespace

**Rules:**

- At most one blank line between any two declarations.
- No blank line at the start or end of a code block (exception: readability in very long functions).
- A single blank line between logical groups of declarations within a type.

---

## Parentheses

**Rule: Omit parentheses around top-level expressions in conditions and return statements.**

```swift
// ✅
if x == 0 { ... }
return x * y

// ❌
if (x == 0) { ... }
return (x * y)
```

Parentheses are acceptable inside an expression when they genuinely improve readability.

---

## Formatting Specific Constructs

### Non-Documentation Comments

Use `//` for inline implementation notes, not `/* */`.

```swift
// ✅
// This accounts for the edge case where count is zero.
let adjusted = max(count, 1)

// ❌
/* This accounts for the edge case where count is zero. */
```

### Properties

Computed properties with a single expression use an implicit `get`:

```swift
// ✅
var area: Double { width * height }

// ❌ (unnecessary get/return for single expression)
var area: Double {
  get { return width * height }
}
```

### Switch Statements

Cases are indented at the same level as the `switch` keyword:

```swift
// ✅
switch direction {
case .north:
  goNorth()
case .south:
  goSouth()
default:
  stop()
}
```

### Enum Cases

Each `case` on its own line:

```swift
// ✅
enum Planet {
  case mercury
  case venus
  case earth
}

// ❌
enum Planet {
  case mercury, venus, earth
}
```

Exception: Multiple cases may appear on one line when they share a raw value or are trivially related.

### Trailing Closures

Use trailing closure syntax when a function's last argument is a closure and doing so improves readability:

```swift
// ✅
numbers.map { $0 * $0 }

// ❌ When the label matters for readability, keep it labelled
UIView.animate(withDuration: 0.3, animations: {
  view.alpha = 0
})
```

Do not use trailing closure syntax when the function has multiple closure arguments, as it becomes ambiguous which closure is trailing.

### Trailing Commas

Use trailing commas in multi-line comma-delimited lists. This improves diff quality and makes reordering easier:

```swift
// ✅
let colours = [
  "red",
  "green",
  "blue",
]
```

### Numeric Literals

Use `_` separators to improve readability of large numbers:

```swift
// ✅
let million = 1_000_000
let pi = 3.141_592_653

// ❌
let million = 1000000
```

### Attributes

Place each attribute on its own line above the declaration:

```swift
// ✅
@discardableResult
@MainActor
func loadData() async -> Data { ... }

// ❌
@discardableResult @MainActor func loadData() async -> Data { ... }
```

Short, closely related attributes (e.g., `@IBOutlet weak`) on the same line as the declaration are acceptable when standard practice dictates it.
